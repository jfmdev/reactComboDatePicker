/*
 * reactComboDatePicker v1.0.1
 * http://github.com/jfmdev/reactComboDatePicker
 * «Copyright 2016 Jose F. Maldonado»
 * This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0. If a copy of the MPL was not distributed with this file, You can obtain one at http://mozilla.org/MPL/2.0/.
 */
"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var _extends=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),ComboDatePicker=function(a){function b(a){_classCallCheck(this,b);var c=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));if(c.state={},c.changeCallback=a.onChange,c.model=b.parseDate(a.date,a.timezone),c.attrsDate=a.attrsDate||{},c.attrsMonth=a.attrsMonth||{},c.attrsYear=a.attrsYear||{},"string"!=typeof a.order?c.order="dmy":c.order=a.order.toLowerCase(),c.minDate=b.parseDate(a.minDate,a.timezone),null==c.minDate){var d=new Date;c.minDate=new Date(d.getFullYear()-100,d.getMonth(),d.getDate(),d.getHours(),d.getMinutes(),d.getSeconds(),d.getMilliseconds())}if(c.maxDate=b.parseDate(a.maxDate,a.timezone),null==c.maxDate&&(c.maxDate=new Date),null!=c.model&&c.model<c.minDate&&(c.model=c.minDate),null!=c.model&&c.model>c.maxDate&&(c.model=c.maxDate),c.placeHolders=[null,null,null],void 0!==a.placeholder&&null!==a.placeholder&&("string"==typeof a.placeholder||Array.isArray(a.placeholder))){var e="string"==typeof a.placeholder?a.placeholder.split(","):a.placeholder;3==e.length&&(c.placeHolders=e)}if(c.monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],void 0!==a.months&&null!==a.months){if("string"==typeof a.months){var f=a.months.split(",");12==f.length&&(c.monthNames=f)}Array.isArray(a.months)&&12==a.months.length&&(c.monthNames=a.months)}c.yearList=[];for(var g=c.minDate.getFullYear();g<=c.maxDate.getFullYear();g++)c.yearList.push({value:g,name:g});return"string"==typeof a.yearOrder&&0==a.yearOrder.indexOf("des")&&c.yearList.reverse(),c.changeCallback&&c.changeCallback(c,c.model),c}return _inherits(b,a),_createClass(b,[{key:"render",value:function(){var c=this,d=this.getMonthList(),e=this.getDateList(),f={d:React.createElement(b.MySelect,{attrs:this.attrsDate,type:"date",model:this.model,items:e,placeholder:this.placeHolders[2],ref:function(b){return c._date=b},onChange:this.updateModel.bind(this)}),m:React.createElement(b.MySelect,{attrs:this.attrsMonth,type:"month",model:this.model,items:d,placeholder:this.placeHolders[1],ref:function(b){return c._month=b},onChange:this.updateModel.bind(this)}),y:React.createElement(b.MySelect,{attrs:this.attrsYear,type:"year",model:this.model,items:this.yearList,placeholder:this.placeHolders[0],ref:function(b){return c._year=b},onChange:this.updateModel.bind(this)})};return React.createElement("span",null,f[this.order.charAt(0)],f[this.order.charAt(1)],f[this.order.charAt(2)])}},{key:"getDateList",value:function(){var c=1;null!=this.model&&this.model.getMonth()==this.minDate.getMonth()&&this.model.getFullYear()==this.minDate.getFullYear()&&(c=this.minDate.getDate());var d=null!=this.model?b.maxDate(this.model.getMonth()+1,this.model.getFullYear()):31;null!=this.model&&this.model.getMonth()==this.maxDate.getMonth()&&this.model.getFullYear()==this.maxDate.getFullYear()&&(d=this.maxDate.getDate());for(var e=[],f=c;f<=d;f++)e.push({value:f,name:f});return e}},{key:"getMonthList",value:function(){for(var b=null!=this.model&&this.model.getFullYear()==this.minDate.getFullYear()?this.minDate.getMonth():0,c=null!=this.model&&this.model.getFullYear()==this.maxDate.getFullYear()?this.maxDate.getMonth():11,d=[],e=b;e<=c;e++)d.push({value:e,name:this.monthNames[e]});return d}},{key:"updateModel",value:function(){var c=this._date.getValue(),d=this._month.getValue(),e=this._year.getValue();if(b.isValidValue(c)&&b.isValidValue(d)&&b.isValidValue(e)){var f=b.maxDate(d+1,e);c>f&&(c=f),this.model=new Date,this.model.setFullYear(e),this.model.setMonth(d),this.model.setDate(c),this.model<this.minDate&&(this.model=this.minDate),this.model>this.maxDate&&(this.model=this.maxDate)}else this.model=null;this._date.setItems(this.getDateList()),this._month.setItems(this.getMonthList()),this._year.forceUpdate(),this.changeCallback&&this.changeCallback(this,this.model)}},{key:"getValue",value:function(){return this.model}}],[{key:"isValidValue",value:function(b){return void 0!==b&&null!==b&&""!==b&&!isNaN(b)}},{key:"parseDate",value:function(b,c){var d=null;return void 0!==b&&null!==b&&(b instanceof Date?d=b:"number"!=typeof b&&"string"!=typeof b||(d=new Date(isNaN(b)?b:parseInt(b,10)),d=this.adjustTimezone(d,c))),d}},{key:"adjustTimezone",value:function(b,c){var d=isNaN(c)?(new Date).getTimezoneOffset():60*parseFloat(c);return new Date(b.getTime()+60*d*1e3)}},{key:"maxDate",value:function(b,c){var d=31;return null!=b&&(4!=b&&6!=b&&9!=b&&11!=b||(d=30),null!=c&&2==b&&(d=c%4==0&&c%100!=0?29:28)),d}}]),b}(React.Component);ComboDatePicker.MySelect=function(a){function b(a){_classCallCheck(this,b);var c=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.state={},c.state.items=a.items||[],c.value=null,a.model&&("d"!=a.type&&"date"!=a.type||(c.value=a.model.getDate()),"m"!=a.type&&"month"!=a.type||(c.value=a.model.getMonth()),"y"!=a.type&&"year"!=a.type||(c.value=a.model.getFullYear())),c.type=a.type,c.placeholder=a.placeholder?a.placeholder:null,c.attributes=a.attrs||{},c.changeCallback=a.onChange,c.handleChange=c.handleChange.bind(c),c}return _inherits(b,a),_createClass(b,[{key:"render",value:function(){if(this.value&&this.state.items){var b=this.state.items[0].value,c=this.state.items[this.state.items.length-1].value;if(b>c){var d=b;b=c,c=d}this.value<b&&(this.value=b),this.value>c&&(this.value=c)}for(var e=[],f=0;f<this.state.items.length;f++)e.push(React.createElement("option",{value:this.state.items[f].value,selected:this.state.items[f].value==this.value},this.state.items[f].name));return this.placeholder?e.unshift(React.createElement("option",_extends({value:""},this.value?{disabled:!0}:{}),this.placeholder)):this.value||e.unshift(React.createElement("option",{value:""})),React.createElement("select",_extends({onChange:this.handleChange},this.attributes),e)}},{key:"handleChange",value:function(b){this.value=parseInt(b.target.value,10),this.changeCallback&&this.changeCallback(this)}},{key:"getValue",value:function(){return this.value}},{key:"setItems",value:function(b){this.setState({items:b})}}]),b}(React.Component);
